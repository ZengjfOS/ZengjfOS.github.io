# Android SecretCode

暗码启动应用

# 参考文档

* [MTK 平台客制化暗码指令开启FactoryTest应用](https://blog.csdn.net/TSK_Amine/article/details/88663614)

# 隐藏应用

* 去掉AndroidManifest.xml里的
  ```xml
  <category android:name="android.intent.category.LAUNCHER" /> 
  ```
* vendor/mediatek/proprietary/packages/apps/EngineerMode/AndroidManifest.xml
  ```xml
  <receiver
      android:name=".EngineerModeReceiver"
      android:exported="false" >
      <intent-filter>
          <action android:name="android.provider.Telephony.SECRET_CODE" />
  
          <data
              android:host="3646633"
              android:scheme="android_secret_code" />
      </intent-filter>
  </receiver>
  ```

# Dialer

* 打电话调用暗码流程
  ```
  * vendor/mediatek/proprietary/packages/apps/Dialer/java/com/android/dialer/dialpadview/SpecialCharSequenceMgr.java
    * public static boolean handleChars(Context context, String input, EditText textField)
      * handleSecretCode(context, dialString)
        * TelephonyManagerCompat.handleSecretCode(context, secretCode);
          * vendor/mediatek/proprietary/packages/apps/Dialer/java/com/android/dialer/compat/telephony/TelephonyManagerCompat.java
            * public static void handleSecretCode(Context context, String secretCode)
              * Intent intent = new Intent(SECRET_CODE_ACTION, Uri.parse("android_secret_code://" + secretCode));
                * private static final String SECRET_CODE_ACTION = "android.provider.Telephony.SECRET_CODE";
              * context.sendBroadcast(intent);
  ```

# Calculator

## 等号处理

* https://android.googlesource.com/platform/packages/apps/ExactCalculator/+/7265aa3a922a7e7c0389dae4b26cca562aa777a6/src/com/android/calculator2/Calculator.java#991
  ```Java
  private void onEquals() {
      // Ignore if in non-INPUT state, or if there are no operators.
      if (mCurrentState == CalculatorState.INPUT) {
          if (haveUnprocessed()) {
              setState(CalculatorState.EVALUATE);
              onError(Evaluator.MAIN_INDEX, R.string.error_syntax);
          } else if (mEvaluator.getExpr(Evaluator.MAIN_INDEX).hasInterestingOps()) {
              setState(CalculatorState.EVALUATE);
              mEvaluator.requireResult(Evaluator.MAIN_INDEX, this, mResultText);
          }
      }
  }
  ```

## 启动应用

* platform/packages/apps/ExactCalculator/src/com/android/calculator2/Calculator.java
  ```Java
  public boolean startOtherApp(String calText) {
      Intent intent = new Intent();
      ComponentName cn = new ComponentName("com.mediatek.engineermode", "com.mediatek.engineermode.EngineerMode");  
      intent.setComponent(cn);
      
      intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
      mContext.startActivity(intent);
      return true;
  }
  ```
